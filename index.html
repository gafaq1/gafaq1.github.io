
<!DOCTYPE html>
<html lang="ru">
<head>
<script>
    (function (window, document, dataLayerName, containerID) {
        window[dataLayerName] = window[dataLayerName] || [];
        window[dataLayerName].push({ 'start': new Date().getTime(), event: 'actm-js' });
        var firstScript = document.getElementsByTagName('script')[0];
        var script = document.createElement('script');
        var dl = dataLayerName !== 'acDataLayer' ? '&l=' + dataLayerName : '';
        script.async = true;
        script.src = 'https://pxl.ru.altkraft.com/actm/js/actm.js?id=' + containerID + dl;
        script.type = 'module';
        if (firstScript && firstScript.parentNode) {
            firstScript.parentNode.insertBefore(script, firstScript);
        }
    }(window, document, 'acDataLayer', 'ATM-AQrx2skHFx-du9Ie7'));
</script> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 5. Тестирование браузерных пушей</title>
 
</head>
<body>




<script>
(function (popupFunc) {
    var script = document.createElement('script');
    var firstScript = document.getElementsByTagName('script')[0];
    var popupFuncName = popupFunc !== 'acpopup' ? '?f=' + popupFunc : '';
    window[popupFunc] = window[popupFunc] || function () {
        (window[popupFunc].actions = window[popupFunc].actions || []).push(arguments);
    };
    window[popupFunc].last_init = 1 * new Date();
    script.async = true;
    script.src = 'https://pxl.ru.altkraft.com/popup/v1/js/popupLibrary.js' + popupFuncName;
    firstScript.parentNode.insertBefore(script, firstScript);
})('acpopup');
</script>

<script>
// === Настройки ===
const popupChain = [
  { id: 'AP-4jAsUuppDyGo3ccLy', delay: 0 },   // Попап №1, сразу
  { id: 'AP-4jAsUuppDy5rs92zO', delay: 3000 }, // Попап №2 через 3 сек после закрытия №1
  { id: 'AP-7Lq2Y1q3pvMaEryGW', delay: 2000 }  // Попап №3 через 2 сек после закрытия №2
];

// === Сервисная функция ===
function waitForPopupToClose(callback) {
  const observer = new MutationObserver(() => {
    const popupVisible = document.querySelector('[class*="ac-popup"]'); 
    if (!popupVisible) {
      observer.disconnect();
      callback();
    }
  });

  // следим за всем body
  observer.observe(document.body, { childList: true, subtree: true });
}

// === Основная логика ===
function showPopupChain(index = 0) {
  if (index >= popupChain.length) return;

  const popup = popupChain[index];
  acpopup('create', popup.id);
  acpopup('show', popup.id);

  console.log('Показан попап', popup.id);

  // ждём закрытия попапа
  waitForPopupToClose(() => {
    console.log('Закрыт попап', popup.id);
    // запускаем следующий попап с задержкой
    setTimeout(() => showPopupChain(index + 1), popup.delay);
  });
}

// === Запуск по триггеру ===
window.addEventListener('load', function() {
  // Пример триггера — клик по кнопке
  const trigger = document.querySelector('#start-popup-chain');
  if (trigger) {
    trigger.addEventListener('click', () => {
      showPopupChain();
    });
  } else {
    // можно автозапуск, если нет кнопки
    // showPopupChain();
  }
});
</script>

<!-- Пример кнопки-триггера -->
<button id="start-popup-chain" style="margin:50px;padding:10px 20px;">Запустить цепочку попапов</button>

       
    <!-- Разместите скрипт для пуш-уведомлений здесь -->

    <p>Урок 5. Тестирование браузерных пушей</p>
    

	
            <script src=https://pxl.demo.altcraft.com/form/js/embed_v1.js></script>
<iframe src="https://pxl.demo.altcraft.com/form?form=8NJf1mCeuRv75dBenr42Gi2KgPRTf4wjgMSg1WGJyRaRWxYT672iWRqMvcmLm81JmjRUjkcGjvcvJtjTHwVQyRG2&iframe=1" frameborder="0" name="ak-form-8NJf1mCeuRv75dBenr42Gi2KgPRTf4wjgMSg1WGJyRaRWxYT672iWRqMvcmLm81JmjRUjkcGjvcvJtjTHwVQyRG2" class="ak-form" width="100%" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox allow-top-navigation"></iframe>

</body>
</html>
