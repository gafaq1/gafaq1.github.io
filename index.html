
<!DOCTYPE html>
<html lang="ru">
<head>
<script>
    (function (window, document, dataLayerName, containerID) {
        window[dataLayerName] = window[dataLayerName] || [];
        window[dataLayerName].push({ 'start': new Date().getTime(), event: 'actm-js' });
        var firstScript = document.getElementsByTagName('script')[0];
        var script = document.createElement('script');
        var dl = dataLayerName !== 'acDataLayer' ? '&l=' + dataLayerName : '';
        script.async = true;
        script.src = 'https://pxl.ru.altkraft.com/actm/js/actm.js?id=' + containerID + dl;
        script.type = 'module';
        if (firstScript && firstScript.parentNode) {
            firstScript.parentNode.insertBefore(script, firstScript);
        }
    }(window, document, 'acDataLayer', 'ATM-AQrx2skHFx-du9Ie7'));
</script> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 5. Тестирование браузерных пушей</title>
 
</head>
<body>
<script>
/* === Инициализация Altcraft Popup Library === */
(function (popupFunc) {
    var script = document.createElement('script');
    var firstScript = document.getElementsByTagName('script')[0];
    var popupFuncName = popupFunc !== 'acpopup' ? '?f=' + popupFunc : '';
    window[popupFunc] = window[popupFunc] || function () {
        (window[popupFunc].actions = window[popupFunc].actions || []).push(arguments);
    };
    window[popupFunc].last_init = 1 * new Date();
    script.async = true;
    script.src = 'https://pxl.ru.altkraft.com/popup/v1/js/popupLibrary.js' + popupFuncName;
    firstScript.parentNode.insertBefore(script, firstScript);
})('acpopup');
</script>

<script>
/* === Настройки цепочки попапов === */
const popupChain = [
  { id: 'AP-4jAsUuppDyGo3ccLy', delay: 1000 },  // Попап №1, показываем первым, пауза 1 сек после закрытия
  { id: 'AP-4jAsUuppDy5rs92zO', delay: 2000 },  // Попап №2, пауза 2 сек после закрытия
  { id: 'AP-7Lq2Y1q3pvMaEryGW', delay: 2000 }   // Попап №3, пауза 2 сек после закрытия
];

/**
 * Функция ждёт, пока текущий попап исчезнет из DOM
 * (определяем закрытие по отсутствию элементов с классом .ac-popup)
 */
function waitForPopupToClose(callback) {
  const observer = new MutationObserver(() => {
    const popupVisible = document.querySelector('[class*="ac-popup"]');
    if (!popupVisible) {
      observer.disconnect();
      callback();
    }
  });
  observer.observe(document.body, { childList: true, subtree: true });
}

/**
 * Показывает попапы по цепочке
 */
function showPopupChain(index = 0) {
  if (index >= popupChain.length) return; // конец цепочки

  const popup = popupChain[index];
  console.log('Показываю попап:', popup.id);

  // создаём и показываем попап
  acpopup('create', popup.id);
  acpopup('show', popup.id);

  // ждём, пока пользователь его закроет
  waitForPopupToClose(() => {
    console.log('Закрыт попап:', popup.id);
    setTimeout(() => {
      showPopupChain(index + 1);
    }, popup.delay);
  });
}

/**
 * Автоматический запуск через 5 секунд после загрузки страницы
 */
window.addEventListener('load', function() {
  setTimeout(() => {
    console.log('Старт цепочки попапов через 5 секунд после загрузки');
    showPopupChain();
  }, 5000);
});
</script>





<!-- Пример кнопки-триггера -->
<button id="start-popup-chain" style="margin:50px;padding:10px 20px;">Запустить цепочку попапов</button>

       
    <!-- Разместите скрипт для пуш-уведомлений здесь -->

    <p>Урок 5. Тестирование браузерных пушей</p>
    

	
            <script src=https://pxl.demo.altcraft.com/form/js/embed_v1.js></script>
<iframe src="https://pxl.demo.altcraft.com/form?form=8NJf1mCeuRv75dBenr42Gi2KgPRTf4wjgMSg1WGJyRaRWxYT672iWRqMvcmLm81JmjRUjkcGjvcvJtjTHwVQyRG2&iframe=1" frameborder="0" name="ak-form-8NJf1mCeuRv75dBenr42Gi2KgPRTf4wjgMSg1WGJyRaRWxYT672iWRqMvcmLm81JmjRUjkcGjvcvJtjTHwVQyRG2" class="ak-form" width="100%" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox allow-top-navigation"></iframe>

</body>
</html>
